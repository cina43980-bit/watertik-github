<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WaterTik v2.3 Final - Download TikTok Tanpa Watermark</title>
<style>
:root{
  --bg:#f8fafc; --card:#ffffff; --primary:#0ea5e9; --accent:#3b82f6; --warn:#fef3c7;
  --muted:#6b7280; --danger:#b91c1c; --radius:12px;
  --glass: rgba(255,255,255,0.78);
  --glass-border: rgba(96,165,250,0.12);
}
*{box-sizing:border-box}
body{font-family:Inter,Arial,sans-serif;background:var(--bg);margin:0;padding:18px;transition:background .2s;color:#0f1724}
.container{max-width:760px;margin:18px auto;background:var(--card);padding:18px;border-radius:var(--radius);box-shadow:0 8px 30px rgba(2,6,23,.06)}
#realtime{font-size:14px;text-align:center;color:#374151;margin-bottom:8px}
#newsSlider{background:#eef2ff;color:#075985;padding:8px;border-radius:8px;text-align:center;margin-bottom:12px}
h1{font-size:20px;margin:6px 0;text-align:center;color:var(--accent);cursor:pointer}
.meta{font-size:13px;color:var(--muted);text-align:center;margin-bottom:12px}
.input-row{display:flex;gap:8px;align-items:center}
input[type="url"]{flex:1;padding:10px;border-radius:10px;border:1px solid #e6eef8;font-size:15px;background:transparent}
button{padding:11px;border-radius:10px;border:0;background:var(--primary);color:#fff;font-size:15px;cursor:pointer}
button.full{width:100%;margin-top:12px}
button.small{padding:8px 10px;border-radius:10px;font-size:13px}
#msg{display:none;margin-top:12px;padding:10px;border-radius:10px;font-size:14px;text-align:center}
#countdown{display:block;margin-top:10px;text-align:center;font-weight:600;color:#075985}
#result{display:none;margin-top:14px}
video{width:100%;border-radius:10px;display:block;margin-bottom:8px}
p.caption{font-style:italic;color:#334155;white-space:pre-line;text-align:center;margin-bottom:8px}
a.download{display:block;text-decoration:none;padding:10px;border-radius:10px;background:var(--accent);color:#fff;text-align:center}
footer{margin-top:16px;text-align:center;color:#475569;font-size:14px;user-select:none;padding-top:10px}
#publish{font-weight:600;margin-top:6px}

/* bug popup */
#bugPopup{display:none;position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.6);z-index:9999;align-items:center;justify-content:center}
.bugCard{background:#0f1724;color:#fff;padding:18px;border-radius:10px;max-width:420px;text-align:center}
.bugCard button{margin-top:12px;padding:8px 14px;border-radius:8px;border:0;background:var(--primary);cursor:pointer}

/* chat helper - floating button, manual open, minimal motion */
.chat-bubble{position:fixed;right:18px;bottom:18px;z-index:9999;display:flex;flex-direction:column;align-items:flex-end;gap:10px}
.chat-btn{width:62px;height:62px;border-radius:999px;border:0;background:linear-gradient(135deg,var(--primary),#0596f2);color:white;font-size:26px;cursor:pointer;box-shadow:0 10px 30px rgba(3,105,161,.18);display:flex;align-items:center;justify-content:center}
.chat-window{width:380px;max-width:calc(100% - 40px);height:520px;border-radius:12px;background:linear-gradient(180deg, var(--glass), rgba(250,250,255,0.78));border:1px solid var(--glass-border);backdrop-filter: blur(8px) saturate(120%);box-shadow:0 12px 40px rgba(2,6,23,.18);overflow:hidden;display:flex;flex-direction:column;transform-origin:100% 100%}
/* header */
.chat-header{padding:12px;display:flex;align-items:center;justify-content:space-between}
.chat-title{font-weight:700;color:#0b5ea8}
.chat-close{background:transparent;border:0;font-size:18px;cursor:pointer;color:#0b5ea8}
/* body */
.chat-body{flex:1;padding:12px;overflow:auto;background:transparent;display:flex;flex-direction:column;gap:8px}
.chat-msg{display:flex;width:100%}
.chat-msg.bot{justify-content:flex-start}
.chat-msg.user{justify-content:flex-end}
.msg-bubble{padding:10px 12px;border-radius:12px;color:#111827;max-width:78%}
/* Bot replies wide & clear */
.msg-bubble.bot{
  background:linear-gradient(180deg,#e8f9ff,#e6f7ff);
  border:1px solid #d9f1ff;
  max-width:96%;
  padding:14px;
  font-size:15px;
  line-height:1.35;
  border-radius:12px 12px 12px 6px;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
}
/* user bubble compact */
.msg-bubble.user{
  background:linear-gradient(180deg,#065f46,#054f3d);
  color:white;
  max-width:62%;
  padding:10px 12px;
  font-size:14px;
  line-height:1.3;
  border-radius:12px 12px 6px 12px;
}
.chat-footer{padding:10px;border-top:1px solid rgba(14,165,233,0.08);display:flex;gap:8px;align-items:center}
.chat-input{flex:1;padding:8px;border-radius:10px;border:1px solid #e6eef8;background:transparent}

/* quick faqs list (with > prefix) */
.faqs{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
.faq-btn{background:rgba(59,130,246,0.06);color:#0b5ea8;padding:8px 12px;border-radius:999px;font-size:13px;cursor:pointer;border:1px solid rgba(59,130,246,0.10);display:inline-flex;align-items:center;gap:8px}
.faq-prefix{font-weight:700;color:#075985;margin-right:4px}

/* report footer button (small & unobtrusive) */
.report-footer{display:inline-block;margin-top:10px;padding:8px 12px;border-radius:10px;background:linear-gradient(135deg,#e6f7ff,#dbeafe);color:#0b5ea8;border:1px solid #c7e8ff;font-size:13px;cursor:pointer}

/* typing indicator */
.typing{font-style:italic;color:#6b7280;padding:6px 10px;border-radius:8px;background:rgba(0,0,0,0.02);display:inline-block}

/* responsive */
@media(max-width:480px){
  .chat-window{width:92vw;height:64vh}
  .container{padding:12px}
  .chat-btn{width:56px;height:56px;font-size:22px}
  .msg-bubble.bot{max-width:94%}
  .msg-bubble.user{max-width:80%}
}
</style>
</head>
<body>
  <div class="container" role="main">
    <div id="realtime">Memuat waktu...</div>
    <div id="newsSlider">Memuat berita terbaru...</div>

    <h1 id="mainTitle">WaterTik ‚Äî Download TikTok tanpa watermark</h1>

    <div class="meta">
      <div id="updateInfo">Update terakhir: Memuat...</div>
      <div id="statusBox">Status: Memuat...</div>
    </div>

    <div class="input-row" style="margin-bottom:8px">
      <input id="urlInput" type="url" placeholder="Tempel link TikTok (https://www.tiktok.com/...)" aria-label="URL TikTok"/>
    </div>

    <button id="downloadBtn" class="full" aria-label="Download Video">‚¨áÔ∏è Download Video Tanpa Watermark</button>

    <div id="msg" role="status" aria-live="polite"></div>
    <div id="countdown" aria-hidden="true"></div>

    <div id="result" aria-live="polite">
      <h3 id="videoTitle"></h3>
      <video id="videoPlayer" controls></video>
      <p id="videoCaption" class="caption"></p>
      <a id="downloadLink" class="download" href="#" target="_blank" rel="noreferrer">‚¨áÔ∏è Download Manual Tanpa Watermark</a>
    </div>

    <footer id="lockFooter">
      <div>¬© 2025 WaterTik | By Fikri</div>
      <div id="publish">Web diterbitkan: 3 Oktober 2025</div>
      <div>
        <button id="footerReportBtn" class="report-footer" title="Laporkan link bermasalah">Laporkan Link Bermasalah</button>
      </div>
    </footer>
  </div>

  <!-- bug popup -->
  <div id="bugPopup" style="display:none;align-items:center;">
    <div class="bugCard">
      <div id="bugText">Terjadi masalah ‚Äî tim sedang memeriksa.</div>
      <button onclick="closeBug()">Tutup</button>
    </div>
  </div>

  <!-- CHAT HELPER (floating manual) -->
  <div class="chat-bubble" id="chatBubble" aria-hidden="false">
    <div id="chatWindow" class="chat-window" style="display:none;" role="dialog" aria-labelledby="chatTitle" aria-modal="false">
      <div class="chat-header">
        <div class="chat-title" id="chatTitle">Bantuan WaterTik</div>
        <button class="chat-close" id="chatClose" aria-label="Tutup">‚úï</button>
      </div>

      <div class="chat-body" id="chatBody" aria-live="polite">
        <!-- initial bot message -->
        <div class="chat-msg bot"><div class="msg-bubble bot">Halo! üëã Ketik pertanyaan atau pilih pertanyaan cepat. Jawaban akan muncul lebar agar mudah dibaca.</div></div>
      </div>

      <div style="padding:8px 12px;border-top:1px solid rgba(14,165,233,0.06);background:transparent">
        <div style="font-size:13px;color:var(--muted)">Pertanyaan cepat:</div>
        <div class="faqs" id="faqList" style="margin-top:8px"></div>
      </div>

      <div class="chat-footer">
        <input id="chatInput" class="chat-input" placeholder="Ketik pertanyaan, mis. kenapa video tidak terdownload?" aria-label="Chat input"/>
        <button id="sendBtn" class="small" aria-label="Kirim">Kirim</button>
        <button id="moreFaq" class="small" aria-label="+ Pertanyaan Lain">+ Pertanyaan Lain</button>
      </div>
    </div>

    <button id="chatToggleBtn" class="chat-btn" title="Bantuan" aria-label="Bantuan">üí¨</button>
  </div>

<script>
/* ================= CONFIG & CONST ================= */
const LATEST_UPDATE_GLOBAL = '16 Oktober 2025 - 17:35:00 (v2.3)';
const API_PROXY='https://api.allorigins.win/raw?url=';
const TIKWM_BASE='https://www.tikwm.com/api/?url=';
const TIMEOUT_MS=10000, MAX_RETRIES=2;

/* ========== ELEMENTS ========== */
const realtimeEl=document.getElementById('realtime');
const newsSlider=document.getElementById('newsSlider');
const statusBox=document.getElementById('statusBox');
const updateInfoEl=document.getElementById('updateInfo');
const urlInput=document.getElementById('urlInput');
const downloadBtn=document.getElementById('downloadBtn');
const msgEl=document.getElementById('msg');
const countdownEl=document.getElementById('countdown');
const resultEl=document.getElementById('result');
const videoTitle=document.getElementById('videoTitle');
const videoPlayer=document.getElementById('videoPlayer');
const videoCaption=document.getElementById('videoCaption');
const downloadLink=document.getElementById('downloadLink');
const bugPopup=document.getElementById('bugPopup');
const bugText=document.getElementById('bugText');
const lockFooter=document.getElementById('lockFooter');
const footerReportBtn=document.getElementById('footerReportBtn');

const chatToggleBtn = document.getElementById('chatToggleBtn');
const chatWindow = document.getElementById('chatWindow');
const chatClose = document.getElementById('chatClose');
const chatBody = document.getElementById('chatBody');
const faqListEl = document.getElementById('faqList');
const chatInput = document.getElementById('chatInput');
const sendBtn = document.getElementById('sendBtn');
const moreFaqBtn = document.getElementById('moreFaq');

/* ========== INITIALIZE ========== */
function setUpdateText(v){ updateInfoEl.textContent = 'Update terakhir: ' + v; }
setUpdateText(LATEST_UPDATE_GLOBAL);
if(localStorage.getItem('watertik_update_time')) setUpdateText(localStorage.getItem('watertik_update_time'));

/* Developer quick-update */
function setUpdateNow(){
  const now=new Date();
  const t=now.toLocaleString('id-ID',{day:'2-digit',month:'long',year:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'});
  const v=`${t} (v2.3 dev)`;
  localStorage.setItem('watertik_update_time', v);
  setUpdateText(v);
  showMsg('‚úî Update terakhir diset ke: '+v, '#d1fae5', '#065f46', 2200);
}
let tapCount=0,lastTap=0;
document.getElementById('mainTitle').addEventListener('click', ()=>{ const t=Date.now(); if(t-lastTap<700) tapCount++; else tapCount=1; lastTap=t; if(tapCount>=5){ setUpdateNow(); tapCount=0; }});
document.addEventListener('keydown', e=>{ if(e.ctrlKey && e.shiftKey && (e.key==='U'||e.key==='u')) setUpdateNow(); });

/* UI helpers */
function showMsg(t,b='#fffbe6',c='#92400e',time=null){
  msgEl.style.display='block'; msgEl.style.background=b; msgEl.style.color=c; msgEl.textContent=t;
  if(time) setTimeout(()=>msgEl.style.display='none',time);
}
function hideMsg(){ msgEl.style.display='none'; }

/* news slider & realtime */
const newsList=[
  "v2.3 Final: Semua fitur lengkap ‚Äî Chat Bantuan, Laporan, Dev shortcuts & lebih.",
  "Caption TikTok tampil otomatis ketika tersedia üìù",
  "Server maintenance tiap 00:00-06:00 (waktu server) ‚Äî countdown aktif ‚è±Ô∏è",
  "By Fikri ‚Ä¢ Web publish 3 Oktober 2025 üîí"
];
let ni=0; function slideNews(){ newsSlider.textContent='üì∞ '+newsList[ni]; ni=(ni+1)%newsList.length; }
slideNews(); setInterval(slideNews,5000);
function updateRealtime(){ const now=new Date(); const date=now.toLocaleDateString('id-ID',{day:'2-digit',month:'long',year:'numeric'}); const time=now.toLocaleTimeString('id-ID',{hour12:false}); realtimeEl.textContent=`üïí Waktu sekarang: ${date}, ${time}`; }
updateRealtime(); setInterval(updateRealtime,1000);

/* footer lock */
const originalFooterHTML = lockFooter.innerHTML;
const footerObserver = new MutationObserver(()=>{ if(lockFooter.innerHTML !== originalFooterHTML) lockFooter.innerHTML = originalFooterHTML; });
footerObserver.observe(lockFooter, { childList:true, subtree:true, characterData:true });

/* maintenance / rest countdown */
function isRest(){ const h=new Date().getHours(); return (h>=0 && h<6); }
function msUntilNextActive(){ const n=new Date(); const t=new Date(n); t.setHours(6,0,0,0); return t-n; }
function formatMs(ms){ if(ms<=0) return '00:00:00'; const s=Math.floor(ms/1000)%60, m=Math.floor(ms/60000)%60, h=Math.floor(ms/3600000); return String(h).padStart(2,'0')+':'+String(m).padStart(2,'0')+':'+String(s).padStart(2,'0'); }
function updateStatusAndCountdown(){ if(isRest()){ statusBox.textContent='Status: Istirahat üí§'; document.body.style.background='#f0f9ff'; downloadBtn.disabled=true; const rem=msUntilNextActive(); countdownEl.style.display='block'; countdownEl.textContent='Server aktif kembali dalam '+formatMs(rem); hideMsg(); } else { statusBox.textContent='Status: Aktif ‚úÖ'; document.body.style.background=''; downloadBtn.disabled=false; countdownEl.style.display='none'; } }
updateStatusAndCountdown(); setInterval(updateStatusAndCountdown,1000);

/* network fetch util */
async function fetchWithTimeout(url, timeout = TIMEOUT_MS, retries = MAX_RETRIES){
  let err;
  for(let i=0;i<=retries;i++){
    const c = new AbortController(); const id = setTimeout(()=>c.abort(), timeout);
    try{
      const res = await fetch(url, { signal: c.signal });
      clearTimeout(id);
      if(!res.ok){ err = new Error('server'); continue; }
      const j = await res.json(); return j;
    }catch(e){
      clearTimeout(id); err = e;
      if(i < retries) await new Promise(r=>setTimeout(r,400));
      else throw err;
    }
  }
  throw err;
}

/* fetch video data */
async function fetchVideoData(url){
  if(!url || !url.includes('tiktok.com')) throw new Error('invalid');
  const proxyUrl = API_PROXY + encodeURIComponent(TIKWM_BASE + url);
  const data = await fetchWithTimeout(proxyUrl);
  if(!data || !data.data || !data.data.play){
    if(data && data.data && data.data.private) throw new Error('private');
    throw new Error('notfound');
  }
  return data.data;
}

/* auto download */
function autoDownload(url,name){ const a=document.createElement('a'); a.href=url; a.download = name || 'video_tiktok.mp4'; document.body.appendChild(a); a.click(); a.remove(); }

/* main download handler */
let inflight=false;
downloadBtn.addEventListener('click', async ()=>{
  const url = urlInput.value.trim();
  hideMsg();
  if(!url){ showMsg('Masukkan link TikTok terlebih dahulu.'); return; }
  if(isRest()){ showMsg('Web sedang istirahat. Tunggu hingga aktif kembali.'); return; }
  if(inflight) return;
  inflight=true;
  downloadBtn.disabled=true; downloadBtn.textContent='Memproses...'; resultEl.style.display='none';
  try{
    const d = await fetchVideoData(url);
    videoTitle.textContent = d.author?.nickname ? '@'+d.author.nickname : 'Video TikTok';
    videoCaption.textContent = d.title || '(Tidak ada caption)';
    videoPlayer.src = d.play;
    downloadLink.href = d.play;
    resultEl.style.display='block';
    videoPlayer.scrollIntoView({behavior:'smooth'});
    autoDownload(d.play, (d.title||'Video_TikTok') + '_NoWatermark.mp4');
    showMsg('Download dimulai ‚Äî periksa folder unduhan.', '#d1fae5', '#065f46', 3000);
  }catch(e){
    if(e.message==='server'){ showMsg('Server API bermasalah. Coba lagi nanti.'); bugText.textContent='Gagal menghubungi API (server).'; showBug(); }
    else if(e.message==='notfound'){ showMsg('Video tidak ditemukan atau link salah.'); }
    else if(e.message==='private'){ showMsg('Belum bisa. Video private hanya bisa diunduh oleh pemiliknya.'); }
    else if(e.name==='AbortError'){ showMsg('Permintaan timeout (koneksi lambat).'); }
    else if(e.message==='invalid'){ showMsg('Link tidak valid. Pastikan link TikTok benar.'); }
    else{ showMsg('Terjadi error tak terduga.'); bugText.textContent='Error: '+(e.message||e.name); showBug(); }
  } finally {
    inflight=false; downloadBtn.disabled=isRest(); downloadBtn.textContent='‚¨áÔ∏è Download Video Tanpa Watermark';
  }
});
downloadLink.addEventListener('click', e=>{ e.preventDefault(); if(downloadLink.href) autoDownload(downloadLink.href); });
function showBug(){ bugPopup.style.display='flex'; }
function closeBug(){ bugPopup.style.display='none'; }
urlInput.addEventListener('keydown', e=>{ if(e.key==='Enter') downloadBtn.click(); });
window.addEventListener('load', ()=>urlInput.focus());

/* ========== CHAT: improved interactive logic ========== */
/* FAQ pool */
const FAQS = [
  {q:"Kenapa videonya gak bisa diunduh?", a:"Kemungkinan penyebab: link salah, video dihapus, video privat, atau server proxy (TikWM) sedang sibuk. Pastikan link hasil 'Bagikan‚ÜíSalin tautan'."},
  {q:"Apa maksud link tidak valid?", a:"Artinya format URL tidak dikenali. Gunakan tautan langsung dari tombol Bagikan di aplikasi TikTok (https://www.tiktok.com/...)."},
  {q:"Bagaimana cara hilangkan watermark?", a:"WaterTik mencoba menyediakan file tanpa watermark bila tersedia dari sumber pengunduh. Jika tidak tersedia, watermark mungkin tidak bisa dihilangkan."},
  {q:"Kenapa muncul error server?", a:"Server proxy yang menghubungkan ke TikTok (mis. tikwm) kadang bermasalah. Coba beberapa menit lagi atau periksa koneksi internet."},
  {q:"Kenapa audio/video terpisah atau suaranya hilang?", a:"Beberapa format video di TikTok dapat terdownload tanpa audio saat metode pengambilan berbeda. Jika sering terjadi, coba opsi manual atau sumber lain."},
  {q:"Bisa download video private?", a:"Tidak. Video private hanya bisa diunduh oleh pemilik yang punya akses."},
  {q:"Apakah WaterTik gratis?", a:"Ya, versi publik ini gratis tanpa login."},
  {q:"Apakah data saya disimpan?", a:"Tidak. WaterTik hanya memproses link di browser dan tidak menyimpan data pribadi pada server kami."}
];

/* smarter matching keywords -> answer */
const KEYWORDS = [
  {k:['tidak bisa','gak bisa','gagal','fail','unduh'], a:FAQS[0].a},
  {k:['invalid','tidak valid','link tidak'], a:FAQS[1].a},
  {k:['watermark','hilangkan watermark','hapus watermark'], a:FAQS[2].a},
  {k:['server','error server','server api'], a:FAQS[3].a},
  {k:['audio','suara','suara hilang','suara tidak'], a:FAQS[4].a},
  {k:['private','privat'], a:FAQS[5].a},
  {k:['gratis','bayar','harga'], a:FAQS[6].a},
  {k:['data','disimpan','privasi'], a:FAQS[7].a}
];

/* helper to create message bubble */
function createBubble(role, text, isTyping=false){
  const wrap = document.createElement('div');
  wrap.className = 'chat-msg ' + (role==='bot' ? 'bot' : 'user');
  const bubble = document.createElement('div');
  bubble.className = 'msg-bubble ' + (role==='bot' ? 'bot' : 'user');
  if(isTyping){
    bubble.innerHTML = '<span class="typing">mengetik</span>';
  } else {
    bubble.textContent = text;
  }
  wrap.appendChild(bubble);
  return {wrap, bubble};
}

/* append user message then bot reply with typing indicator and smarter matching */
function sendToBot(userText){
  // append user bubble
  const user = createBubble('user', userText);
  chatBody.appendChild(user.wrap);
  chatBody.scrollTop = chatBody.scrollHeight;

  // create bot typing placeholder
  const botPlaceholder = createBubble('bot','', true);
  chatBody.appendChild(botPlaceholder.wrap);
  chatBody.scrollTop = chatBody.scrollHeight;

  // compute answer (simulate processing)
  const answer = computeAnswer(userText);

  // simulate short typing delay proportional to length
  const delay = Math.min(1400 + Math.max(0, answer.length * 6), 2800);
  setTimeout(()=>{
    // replace typing with actual answer
    botPlaceholder.bubble.textContent = answer;
    chatBody.scrollTop = chatBody.scrollHeight;
  }, delay);
}

/* compute answer using keywords and faq; fallback friendly */
function computeAnswer(msg){
  const t = msg.toLowerCase();
  // exact matches first
  for(const f of FAQS) if(t === f.q.toLowerCase()) return f.a;
  // keywords match
  for(const k of KEYWORDS){
    for(const kw of k.k){
      if(t.includes(kw)) return k.a;
    }
  }
  // link/help hints
  if(t.includes('cara') && t.includes('download')) return "Untuk mengunduh: buka video di TikTok ‚Üí Bagikan ‚Üí Salin tautan ‚Üí tempel di kolom lalu tekan Download.";
  if(t.includes('kenapa') || t.includes('mengapa')) return "Coba periksa koneksi dan format link. Jika masih gagal, kirim linknya lewat tombol 'Laporkan Link Bermasalah'.";
  // fallback
  return "Maaf, aku belum paham sepenuhnya. Coba pilih salah satu pertanyaan cepat atau jelaskan lebih rinci (mis. 'Link: https://...').";
}

/* render FAQ buttons */
function renderFaqButtons(limit){
  faqListEl.innerHTML = '';
  const items = FAQS.slice(0, limit || FAQS.length);
  items.forEach(f => {
    const btn = document.createElement('button');
    btn.className = 'faq-btn';
    const prefix = document.createElement('span'); prefix.className='faq-prefix'; prefix.textContent='>';
    btn.appendChild(prefix); btn.appendChild(document.createTextNode(f.q));
    btn.addEventListener('click', ()=> {
      // when clicked, send to bot (so it will show user bubble + bot reply)
      sendToBot(f.q);
    });
    faqListEl.appendChild(btn);
  });
}
renderFaqButtons(8);

/* moreFaq: push full list into chat body as clickable items */
moreFaqBtn.addEventListener('click', ()=>{
  appendBot("Berikut daftar pertanyaan cepat ‚Äî ketuk salah satu untuk jawaban.");
  FAQS.forEach(f=>{
    const el = document.createElement('button');
    el.className='faq-btn';
    el.style.margin='6px 6px 0 0';
    const pref = document.createElement('span'); pref.className='faq-prefix'; pref.textContent='>';
    el.appendChild(pref); el.appendChild(document.createTextNode(f.q));
    el.onclick = ()=> sendToBot(f.q);
    chatBody.appendChild(el);
  });
  chatBody.scrollTop = chatBody.scrollHeight;
});

/* append bot simple message (no typing) */
function appendBot(text){
  const b = createBubble('bot', text);
  chatBody.appendChild(b.wrap);
  chatBody.scrollTop = chatBody.scrollHeight;
}

/* handle manual send */
sendBtn.addEventListener('click', ()=>{
  const v = chatInput.value.trim();
  if(!v) return;
  chatInput.value = '';
  sendToBot(v);
});
chatInput.addEventListener('keydown', e=> { if(e.key==='Enter') sendBtn.click(); });

/* open/close chat */
chatToggleBtn.addEventListener('click', ()=> {
  if(chatWindow.style.display === 'none' || chatWindow.style.display === '') {
    chatWindow.style.display = 'flex';
    setTimeout(()=> chatInput.focus(), 150);
  } else {
    chatWindow.style.display = 'none';
  }
});
chatClose.addEventListener('click', ()=> { chatWindow.style.display = 'none'; });

/* initial greeting */
setTimeout(()=>{ appendBot('Butuh bantuan? Ketik pertanyaan atau pilih tombol >.'); }, 600);

/* ========== Footer report (mailto) + Gmail fallback ========== */
footerReportBtn.addEventListener('click', ()=> {
  const url = urlInput.value.trim();
  const now = new Date();
  const ts = now.toLocaleString('id-ID', {day:'2-digit',month:'long',year:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'});
  const subject = encodeURIComponent('Laporan Link Bermasalah - WaterTik');
  const bodyLines = [];
  bodyLines.push('Halo Admin,');
  bodyLines.push('');
  bodyLines.push('Saya ingin melaporkan link TikTok yang bermasalah:');
  bodyLines.push(url || '[BELUM DIISI]');
  bodyLines.push('');
  bodyLines.push('Waktu laporan: ' + ts);
  bodyLines.push('User agent: ' + navigator.userAgent);
  bodyLines.push('');
  bodyLines.push('Silakan periksa. Terima kasih.');
  const body = encodeURIComponent(bodyLines.join('\n'));
  const mailto = `mailto:dllweb9@gmail.com?subject=${subject}&body=${body}`;

  try {
    // coba buka aplikasi email
    window.location.href = mailto;

    // kalau dalam 2 detik belum pindah, tampilkan fallback
    setTimeout(()=>{
      const confirmed = confirm(
        "Sepertinya tidak ada aplikasi email yang terpasang.\n\nKirim manual ke: dllweb9@gmail.com ?"
      );
      if(confirmed){
        navigator.clipboard.writeText('dllweb9@gmail.com');
        alert('Alamat email disalin ke clipboard.\nBuka Gmail lalu tempel alamatnya.');
      }
    }, 2000);
  } catch(e){
    alert("Gagal membuka email. Kirim manual ke: dllweb9@gmail.com");
  }
});

</script>
</body>
</html>  